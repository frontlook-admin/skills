# yaml-language-server: $schema=https://json.schemastore.org/any.json
# Test scenarios for azure-compute-batch-java skill evaluation

config:
  model: gpt-4
  max_tokens: 2000
  temperature: 0.3

scenarios:
  - name: client_creation
    prompt: |
      Create Java code to set up the Azure Batch client using
      DefaultAzureCredential authentication.
    expected_patterns:
      - "BatchClientBuilder"
      - "DefaultAzureCredentialBuilder"
      - "buildClient"
      - 'System\.getenv\('
    forbidden_patterns:
      - 'endpoint\("https://'
    tags:
      - basic
      - authentication
    mock_response: |
      import com.azure.compute.batch.BatchClient;
      import com.azure.compute.batch.BatchClientBuilder;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class ClientSetup {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_BATCH_ENDPOINT");
              
              BatchClient batchClient = new BatchClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildClient();
              
              System.out.println("Client initialized successfully");
          }
      }

  - name: create_pool
    prompt: |
      Create a Java example that creates an Azure Batch pool with
      Ubuntu VMs using VirtualMachineConfiguration.
    expected_patterns:
      - "createPool"
      - "BatchPoolCreateParameters"
      - "VirtualMachineConfiguration"
      - "BatchVmImageReference"
      - "setTargetDedicatedNodes"
    tags:
      - pools
      - basic
    mock_response: |
      import com.azure.compute.batch.BatchClient;
      import com.azure.compute.batch.BatchClientBuilder;
      import com.azure.compute.batch.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class CreatePool {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_BATCH_ENDPOINT");
              
              BatchClient batchClient = new BatchClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildClient();
              
              batchClient.createPool(new BatchPoolCreateParameters("myPoolId", "STANDARD_DC2s_V2")
                  .setVirtualMachineConfiguration(
                      new VirtualMachineConfiguration(
                          new BatchVmImageReference()
                              .setPublisher("Canonical")
                              .setOffer("UbuntuServer")
                              .setSku("22_04-lts")
                              .setVersion("latest"),
                          "batch.node.ubuntu 22.04"))
                  .setTargetDedicatedNodes(2)
                  .setTargetLowPriorityNodes(0), null);
              
              System.out.println("Pool created successfully");
          }
      }

  - name: create_job_and_tasks
    prompt: |
      Create a Java example that creates a Batch job and adds multiple
      tasks to it using task collection.
    expected_patterns:
      - "createJob"
      - "BatchJobCreateParameters"
      - "BatchPoolInfo"
      - "BatchTaskCreateParameters"
      - "createTaskCollection"
      - "BatchTaskGroup"
    tags:
      - jobs
      - tasks
    mock_response: |
      import com.azure.compute.batch.BatchClient;
      import com.azure.compute.batch.BatchClientBuilder;
      import com.azure.compute.batch.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import java.util.Arrays;
      import java.util.List;

      public class CreateJobAndTasks {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_BATCH_ENDPOINT");
              
              BatchClient batchClient = new BatchClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildClient();
              
              // Create job
              batchClient.createJob(
                  new BatchJobCreateParameters("myJobId", new BatchPoolInfo().setPoolId("myPoolId"))
                      .setPriority(100),
                  null);
              
              // Create task collection
              List<BatchTaskCreateParameters> taskList = Arrays.asList(
                  new BatchTaskCreateParameters("task1", "echo Task 1"),
                  new BatchTaskCreateParameters("task2", "echo Task 2"),
                  new BatchTaskCreateParameters("task3", "echo Task 3")
              );
              BatchTaskGroup taskGroup = new BatchTaskGroup(taskList);
              BatchCreateTaskCollectionResult result = batchClient.createTaskCollection("myJobId", taskGroup);
              
              System.out.println("Job and tasks created successfully");
          }
      }

  - name: error_handling
    prompt: |
      Create a Java example showing proper error handling for Batch
      operations with BatchErrorException handling.
    expected_patterns:
      - "BatchErrorException"
      - "try"
      - "catch"
      - "getCode"
      - "getMessage"
    tags:
      - error-handling
    mock_response: |
      import com.azure.compute.batch.BatchClient;
      import com.azure.compute.batch.BatchClientBuilder;
      import com.azure.compute.batch.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class ErrorHandling {
          public static void main(String[] args) {
              String endpoint = System.getenv("AZURE_BATCH_ENDPOINT");
              
              BatchClient batchClient = new BatchClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .endpoint(endpoint)
                  .buildClient();
              
              try {
                  batchClient.getPool("nonexistent-pool");
              } catch (BatchErrorException e) {
                  BatchError error = e.getValue();
                  System.err.println("Error code: " + error.getCode());
                  System.err.println("Message: " + error.getMessage().getValue());
                  
                  if ("PoolNotFound".equals(error.getCode())) {
                      System.err.println("The specified pool does not exist.");
                  }
              }
          }
      }
