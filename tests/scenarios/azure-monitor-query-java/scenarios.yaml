# yaml-language-server: $schema=https://json.schemastore.org/any.json
# Test scenarios for azure-monitor-query-java skill evaluation

config:
  model: gpt-4
  max_tokens: 2000
  temperature: 0.3

scenarios:
  - name: logs_client_creation
    prompt: |
      Create Java code to set up the Azure Monitor LogsQueryClient
      using DefaultAzureCredential authentication.
    expected_patterns:
      - "LogsQueryClientBuilder"
      - "DefaultAzureCredentialBuilder"
      - "buildClient"
    tags:
      - basic
      - authentication
    mock_response: |
      import com.azure.monitor.query.LogsQueryClient;
      import com.azure.monitor.query.LogsQueryClientBuilder;
      import com.azure.identity.DefaultAzureCredentialBuilder;

      public class LogsClientSetup {
          public static void main(String[] args) {
              LogsQueryClient logsClient = new LogsQueryClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              System.out.println("Logs client initialized successfully");
          }
      }

  - name: basic_logs_query
    prompt: |
      Create a Java example that queries Log Analytics workspace
      for Azure Activity logs and prints the results.
    expected_patterns:
      - "queryWorkspace"
      - "LogsQueryResult"
      - "QueryTimeInterval"
      - "getTable"
      - "getRows"
      - "getColumnValue"
    tags:
      - logs
      - query
    mock_response: |
      import com.azure.monitor.query.LogsQueryClient;
      import com.azure.monitor.query.LogsQueryClientBuilder;
      import com.azure.monitor.query.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import java.time.Duration;

      public class BasicLogsQuery {
          public static void main(String[] args) {
              String workspaceId = System.getenv("LOG_ANALYTICS_WORKSPACE_ID");
              
              LogsQueryClient logsClient = new LogsQueryClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              LogsQueryResult result = logsClient.queryWorkspace(
                  workspaceId,
                  "AzureActivity | summarize count() by ResourceGroup | top 10 by count_",
                  new QueryTimeInterval(Duration.ofDays(7))
              );
              
              for (LogsTableRow row : result.getTable().getRows()) {
                  System.out.println(row.getColumnValue("ResourceGroup") + ": " + row.getColumnValue("count_"));
              }
          }
      }

  - name: metrics_query
    prompt: |
      Create a Java example that queries metrics for an Azure resource
      using the MetricsQueryClient.
    expected_patterns:
      - "MetricsQueryClient"
      - "MetricsQueryClientBuilder"
      - "queryResource"
      - "MetricsQueryResult"
      - "getMetrics"
      - "getMetricName"
    tags:
      - metrics
      - query
    mock_response: |
      import com.azure.monitor.query.MetricsQueryClient;
      import com.azure.monitor.query.MetricsQueryClientBuilder;
      import com.azure.monitor.query.models.*;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import java.util.Arrays;

      public class MetricsQuery {
          public static void main(String[] args) {
              String resourceId = System.getenv("AZURE_RESOURCE_ID");
              
              MetricsQueryClient metricsClient = new MetricsQueryClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              MetricsQueryResult result = metricsClient.queryResource(
                  resourceId,
                  Arrays.asList("SuccessfulCalls", "TotalCalls")
              );
              
              for (MetricResult metric : result.getMetrics()) {
                  System.out.println("Metric: " + metric.getMetricName());
                  for (TimeSeriesElement ts : metric.getTimeSeries()) {
                      for (MetricValue value : ts.getValues()) {
                          System.out.println("  " + value.getTimeStamp() + ": " + value.getTotal());
                      }
                  }
              }
          }
      }

  - name: batch_logs_query
    prompt: |
      Create a Java example that executes multiple log queries
      in a single batch request.
    expected_patterns:
      - "LogsBatchQuery"
      - "addWorkspaceQuery"
      - "queryBatchWithResponse"
      - "LogsBatchQueryResultCollection"
      - "getResult"
    tags:
      - logs
      - batch
    mock_response: |
      import com.azure.monitor.query.LogsQueryClient;
      import com.azure.monitor.query.LogsQueryClientBuilder;
      import com.azure.monitor.query.models.*;
      import com.azure.core.util.Context;
      import com.azure.identity.DefaultAzureCredentialBuilder;
      import java.time.Duration;

      public class BatchLogsQuery {
          public static void main(String[] args) {
              String workspaceId = System.getenv("LOG_ANALYTICS_WORKSPACE_ID");
              
              LogsQueryClient logsClient = new LogsQueryClientBuilder()
                  .credential(new DefaultAzureCredentialBuilder().build())
                  .buildClient();
              
              LogsBatchQuery batchQuery = new LogsBatchQuery();
              String q1 = batchQuery.addWorkspaceQuery(workspaceId, "AzureActivity | count", new QueryTimeInterval(Duration.ofDays(1)));
              String q2 = batchQuery.addWorkspaceQuery(workspaceId, "Heartbeat | count", new QueryTimeInterval(Duration.ofDays(1)));
              String q3 = batchQuery.addWorkspaceQuery(workspaceId, "Perf | count", new QueryTimeInterval(Duration.ofDays(1)));
              
              LogsBatchQueryResultCollection results = logsClient
                  .queryBatchWithResponse(batchQuery, Context.NONE)
                  .getValue();
              
              LogsBatchQueryResult result1 = results.getResult(q1);
              LogsBatchQueryResult result2 = results.getResult(q2);
              LogsBatchQueryResult result3 = results.getResult(q3);
              
              System.out.println("Query 1 status: " + result1.getQueryResultStatus());
              System.out.println("Query 2 status: " + result2.getQueryResultStatus());
              System.out.println("Query 3 status: " + result3.getQueryResultStatus());
          }
      }
